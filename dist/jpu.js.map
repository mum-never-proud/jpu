{"version":3,"sources":["constants/instructions.js","services/create-memory.js","utils/create-register-map.js","constants/registers.js","jpu.js"],"names":["MOV_LIT_REG","MOV_REG_REG","MOV_MEM_REG","MOV_REG_MEM","ADD_REG_REG","JMP_NOT_EQ","size","buffer","ArrayBuffer","dv","DataView","registers","reduce","map","name","idx","JPU","memory","registerNames","length","registerMap","hasOwnProperty","getUint16","Error","value","setUint16","nextInstructionAddress","getRegister","nextInstruction","getUint8","setRegister","instruction","fetch16","register","getRegisterOffset","fetch","fromRegister","toRegister","fromMemory","fromReg","toMemory","register1","register2","value1","value2","execute","join","module","exports"],"mappings":"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","file":"jpu.js","sourceRoot":"../src","sourcesContent":["const MOV_LIT_REG = 0x01;\nconst MOV_REG_REG = 0x02;\nconst MOV_MEM_REG = 0x03;\nconst MOV_REG_MEM = 0x04;\n\nconst ADD_REG_REG = 0x10;\n\nconst JMP_NOT_EQ = 0x20;\n\nexport {\n  MOV_LIT_REG,\n  MOV_REG_REG,\n  MOV_MEM_REG,\n  MOV_REG_MEM,\n  ADD_REG_REG,\n  JMP_NOT_EQ\n};\n","export default function (size) { // in bytes\n  const buffer = new ArrayBuffer(size);\n  const dv = new DataView(buffer);\n\n  return dv;\n}\n","export default function (registers) {\n  return registers.reduce((map, name, idx) => {\n    map[name] = idx * 2;\n\n    return map;\n  }, {});\n}\n","export default [\n  'ip', 'acc',\n  'r1', 'r2', 'r3', 'r4'\n];\n","import {\n  MOV_LIT_REG,\n  MOV_REG_REG,\n  MOV_MEM_REG,\n  MOV_REG_MEM,\n  ADD_REG_REG\n} from './constants/instructions';\nimport createMemory from './services/create-memory';\nimport createRegisterMap from './utils/create-register-map';\nimport registerNames from './constants/registers';\n\nclass JPU {\n  constructor (memory) {\n    this.memory = memory;\n    this.registers = createMemory(registerNames.length * 2);\n    this.registerMap = createRegisterMap(registerNames);\n  }\n\n  getRegister (name) {\n    if (this.registerMap.hasOwnProperty(name)) {\n      return this.registers.getUint16(this.registerMap[name]);\n    }\n\n    throw Error('register not found');\n  }\n\n  getRegisterOffset (idx) {\n    return (idx % registerNames.length) * 2;\n  }\n\n  setRegister (name, value) {\n    if (this.registerMap.hasOwnProperty(name)) {\n      return this.registers.setUint16(this.registerMap[name], value);\n    }\n\n    throw Error('register not found');\n  }\n\n  fetch () {\n    const nextInstructionAddress = this.getRegister('ip');\n    const nextInstruction = this.memory.getUint8(nextInstructionAddress);\n\n    this.setRegister('ip', nextInstructionAddress + 1);\n\n    return nextInstruction;\n  }\n\n  fetch16 () {\n    const nextInstructionAddress = this.getRegister('ip');\n    const nextInstruction = this.memory.getUint16(nextInstructionAddress);\n\n    this.setRegister('ip', nextInstructionAddress + 2);\n\n    return nextInstruction;\n  }\n\n  execute (instruction) {\n    switch (instruction) {\n      case MOV_LIT_REG: {\n        const value = this.fetch16();\n        const register = this.getRegisterOffset(this.fetch());\n\n        this.registers.setUint16(register, value);\n\n        return;\n      }\n\n      case MOV_REG_REG: {\n        const fromRegister = this.getRegisterOffset(this.fetch());\n        const toRegister = this.getRegisterOffset(this.fetch());\n        const value = this.registers.getUint16(fromRegister);\n\n        this.registers.setUint16(toRegister, value);\n\n        return;\n      }\n\n      case MOV_MEM_REG: {\n        const fromMemory = this.fetch16();\n        const toRegister = this.getRegisterOffset(this.fetch());\n        const value = this.memory.getUint16(fromMemory);\n\n        this.registers.setUint16(toRegister, value);\n\n        return;\n      }\n\n      case MOV_REG_MEM: {\n        const fromReg = this.getRegisterOffset(this.fetch());\n        const toMemory = this.fetch16();\n        const value = this.registers.getUint16(fromReg);\n\n        this.memory.setUint16(toMemory, value);\n\n        return;\n      }\n\n      case ADD_REG_REG: {\n        const register1 = this.getRegisterOffset(this.fetch());\n        const register2 = this.getRegisterOffset(this.fetch());\n        const value1 = this.registers.getUint16(register1);\n        const value2 = this.registers.getUint16(register2);\n\n        this.setRegister('acc', value1 + value2);\n\n        return;\n      }\n    }\n  }\n\n  step () {\n    this.execute(this.fetch());\n\n    return this;\n  }\n\n  peekMemory () {\n    return registerNames.map(name =>\n      `${name}\\t\\t\\t${this.registers.getUint16(this.registerMap[name])}`\n    ).join('\\n');\n  }\n\n  static createMemory (size) {\n    return createMemory(size);\n  }\n}\n\nmodule.exports = JPU;\n"]}